// Generated by CoffeeScript 1.6.3
(function() {
  var portfolioApp, portfolioControllers;

  portfolioApp = angular.module('portfolioApp', ['smoothScroll', 'ngRoute', 'portfolioControllers']);

  /* Directives*/


  portfolioApp.directive('dnShadowbox', function() {
    return {
      restrict: "E",
      template: '<a href="{{imageUrl}}" rel="shadowbox[Project]"><dn-thumb></dn-thumb></a>',
      scope: {
        imageName: '@name',
        imageUrl: '@url'
      }
    };
  });

  portfolioApp.directive('dnThumb', function() {
    return {
      restrict: 'E',
      template: '<div class="thumbnail"><img ng-src="{{imageUrl}}"></div>',
      scope: false,
      link: function(scope, element, attrs) {
        var div, img;
        div = element.children();
        img = element.children().children();
        return img.on('load', function() {
          var heightDiff;
          heightDiff = img.height() - div.height();
          return img.css('margin-top', -heightDiff / 2);
        });
      }
    };
  });

  /* App Module*/


  portfolioApp.config([
    '$routeProvider', function($routeProvider) {
      return $routeProvider.when('/projects/:projectid', {
        templateUrl: '/partials/project_template.html',
        controller: 'ProjectCtrl'
      }).when('/index', {
        templateUrl: '/partials/index_template.html',
        controller: 'IndexCtrl'
      }).otherwise({
        redirectTo: '/index'
      });
    }
  ]);

  /* Controllers*/


  portfolioControllers = angular.module('portfolioControllers', []);

  portfolioControllers.controller('ProjectCtrl', [
    '$sce', '$scope', '$http', '$routeParams', function($sce, $scope, $http, $routeParams) {
      $scope.projectid = $routeParams.projectid;
      $http.get('projects/' + $routeParams.projectid + '/' + $routeParams.projectid + '.json').success(function(data) {
        $scope.project = data;
        $scope.project.hasPhotos = data.photos.length > 0 ? true : false;
        return $scope.project.description = $sce.trustAsHtml($scope.project.description);
      });
      Shadowbox.init();
      return ga('send', 'pageview', {
        'page': '/projects/' + $routeParams.projectid,
        'title': $routeParams.projectid
      });
    }
  ]);

  portfolioControllers.controller('IndexCtrl', [
    '$scope', '$http', function($scope, $http) {
      $http.get('projects/projects.json').success(function(data) {
        var project, row, _i, _len, _ref, _results;
        $scope.projects = data;
        _ref = $scope.projects;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          row = _ref[_i];
          _results.push((function() {
            var _j, _len1, _results1;
            _results1 = [];
            for (_j = 0, _len1 = row.length; _j < _len1; _j++) {
              project = row[_j];
              _results1.push(project.thumb = 'projects/' + project.id + '/thumb.jpg');
            }
            return _results1;
          })());
        }
        return _results;
      });
      ga('send', 'pageview', {
        'page': '/index.html',
        'title': 'index'
      });
    }
  ]);

}).call(this);
